<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Grid: Editing, Master/Detail</title>
	<link rel="stylesheet" href="../themes/base/jquery.ui.all.css">
	<link rel="stylesheet" href="../grid-spf/grid.css">
	<script src="../jquery-1.5.1.js"></script>
	<script src="../external/jquery.tmpl.js"></script>
	<script src="../external/jquery.mousewheel-3.0.4.js"></script>
	<script src="../ui/jquery.ui.core.js"></script>
	<script src="../ui/jquery.ui.widget.js"></script>
	<script src="../ui/jquery.ui.button.js"></script>
	<script src="../ui/jquery.ui.spinner.js"></script>
	<script src="../grid-spf/datasource.js"></script>
	<script src="../grid-spf/datasource-local.js"></script>
	<script src="localstore.js"></script>
	<script src="helpers.js"></script>
	<script>
	var store = $.demos.localstore( {
		key: "grid-editing-movies",
		initial: "movies.json"
	});
	var localMovies = store.load();

	$(function() {
		var movies = $.ui.localDatasource({
			input: localMovies,
			paging: {
				limit: 8
			}
		});
		movies.save = function() {
			store.save( localMovies );
			return this;
		};

		var movie;
		var editForm = $( "#editForm" ).hide().submit( function( event ) {
			event.preventDefault();
			serializeForm( this, movie );
			movies.save().refresh();
			editForm.hide();
		});
		var list = $("#movies-list").delegate("li:has(li)", "click", function() {
			movie = $( this ).tmplItem().data;
			deserializeForm( editForm, movie );
			editForm.show();
		});
		$(movies).bind("datasourceresponse", function() {
			list.empty().append( $("#movie-list-item").tmpl( localMovies ) );
		});

		$("#addMovie").click(function() {
			localMovies.push({
				title: "New Movie",
				alternative_titles: [],
				languages: [{
					name: "English"
				}]
			});
			movies.save().refresh();
		});

		$("#editForm").hide();

		movies.refresh();
	});
	</script>
</head>
<body>

<h1>Non-grid master/details editing</h1>

<ul id="movies-list">

</ul>

<script id="movie-list-item" type="text/x-jquery-tmpl">
	<li>
		<span>${title}, released ${released}, available in:</span>
		<ul>
			{{each(index, language) languages}}
				<li>${name}</li>
			{{/each}}
		</ul>
	</li>
</script>

<div>
	<button id="addMovie">Insert new movie</button>
</div>
<form id="editForm">
	<input type="text" name="title" placeholder="Title" />
	<input type="text" name="released" placeholder="Release Year" />
	<!--
	<input type="text" name="alternative_titles" size="30" placeholder="Alternative Titles" />
	<input type="text" name="languages" placeholder="Languages" />
	-->
	<input type="submit" value="Save changes" />
</form>

</body>
</html>
