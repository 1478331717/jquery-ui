<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Grid: Editing</title>
	<link rel="stylesheet" href="../themes/base/jquery.ui.all.css">
	<link rel="stylesheet" href="../grid-spf/grid.css">
	<script src="../jquery-1.5.1.js"></script>
	<script src="../external/jquery.tmpl.js"></script>
	<script src="../external/jquery.mousewheel-3.0.4.js"></script>
	<script src="../ui/jquery.ui.core.js"></script>
	<script src="../ui/jquery.ui.widget.js"></script>
	<script src="../ui/jquery.ui.button.js"></script>
	<script src="../ui/jquery.ui.spinner.js"></script>
	<script src="../grid-spf/datasource.js"></script>
	<script src="../grid-spf/datasource-local.js"></script>
	<script src="../grid-spf/grid.js"></script>
	<script src="../grid-spf/pager.js"></script>
	<script src="editor.js"></script>
	<script>
	var localStorageSupport = (function() {
		try {
			return !!localStorage.getItem;
		} catch(e){
			return false;
		}
	})();

	var localDevelopers;
	if ( localStorageSupport ) {
		var item = localStorage.getItem( "grid-editing-developers" );
		if ( item ) {
			localDevelopers = JSON.parse( item );
		}
	}
	if ( !localDevelopers ) {
		$.ajax({
			dataType: "json",
			url: "../grid-spf/developers.json",
			async: false,
			success: function( result ) {
				localDevelopers = result;
			}
		});
	}

	$(function() {
		var developers = $.ui.localDatasource({
			input: localDevelopers,
			paging: {
				limit: 8
			}
		});
		developers.save = function( object ) {
			if ( object ) {
				console.log( "save update to " + object.firstName + " " + object.lastName );
			} else {
				console.log( "save all" );
			}
			if ( localStorageSupport ) {
				localStorage.setItem( "grid-editing-developers", JSON.stringify( localDevelopers ) )
			}
		}

		$( "#developers-local" ).grid({
			source: developers,
			refresh: function() {
				$( this ).find( "td" ).each( function() {
					var th = $( this ).parents( "table:first" ).find( "th" ).eq( this.cellIndex ),
						field = th.data( "field" );
					$( this ).editor({
							type: th.data( "type" ),
							submit: function( event, ui ) {
								var object = $( this ).tmplItem().data;
								object[field] = ui.value;
								developers.save( object );
							}
						})
				});
			}
		});

		$( "#pageDevelopers" ).pager({
			source: developers
		});

		$( "#addDeveloper" ).click( function() {
			// add at front so that it becomes visible without paging
			localDevelopers.unshift({
				firstName: "Peter",
				lastName: "Pan",
				country: "Unknown",
				bitcoins: 0
			});
			developers.save();
			developers.refresh();
		});

		developers.refresh();
	});
	</script>
	<style>
	</style>
</head>
<body>

<h1>Grids with editable local datasource</h1>

<h2>local data source</h2>
<p id="pageDevelopers">
	<button data-page="first">First</button>
	<button data-page="prev">Prev</button>
	<button data-page="prevStep">-1</button>
	<span>
		Page <input class="current" size="4"/>/<span class="total">0</span>,
		Total records <span class="totalRecords">0</span>
	</span>
	<button data-page="nextStep">+1</button>
	<button data-page="next">Next</button>
	<button data-page="last">Last</button>
</p>
<table id="developers-local">
	<thead>
		<tr>
			<!-- see comment in editor.js
			<th data-field="selected" data-type="boolean">Selected</th>
			-->
			<th data-field="firstName">First Name</th>
			<th data-field="lastName">Last Name</th>
			<th data-field="country">Country</th>
			<th data-field="bitcoins" data-type="number">Bitcoins</th>
		</tr>
	</thead>
	<tbody>
	</tbody>
</table>

<div>
	<button id="addDeveloper">Insert developer</button>
</div>

</body>
</html>
