<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Grid: Data</title>
	<link rel="stylesheet" href="../../../themes/base/jquery.ui.all.css">
	<script src="../../../jquery-1.4.4.js"></script>
	<script src="../../../external/jquery.tmpl.js"></script>
	<script src="../../../ui/jquery.ui.core.js"></script>
	<script src="../../../ui/jquery.ui.widget.js"></script>
	<script>
	// widget factory is nice, but we probably won't have an element
	$.widget( "ui.dataitem", {
		options: {
			source: null
		},
		_create: function() {
			this.props = this.options.source;
		},
		get: function( key ) {
			return this.props[ key ];
		},
		set: function( key, value ) {
			this.props[ key ] = value;
			return this;
		}
	});
	
	$.widget( "ui.datastore", {
		options: {
			source: null
		},
		_create: function() {
			var that = this;
			this._items = [];
			$.each( this.options.source, function( i, item ) {
				var dataitem = new $.ui.dataitem({
					source: item
				}, {} );
				dataitem.set( "__ref__", dataitem );
				that._items[ i ] = dataitem;
			});
		},
		item: function( index ) {
			return this._getItems( index, 1 )[ 0 ];
		},
		items: function( offset, limit ) {
			return this._getItems( offset, limit );
		},
		_getItems: function( offset, limit ) {
			return this._items.slice( offset, offset + limit );
		},
		select: function( index ) {
			var item;
			if ( typeof index === "number" ) {
				item = this.item( index )
			} else {
				item = index;
			}
			this._trigger( "select", null, { item: item } );
		}
	});

	var data = [
		{
			firstName: "Scott",
			lastName: "González",
			country: "USA",
			twitter: "scott_gonzalez",
			github: "scottgonzalez"
		},
		{
			firstName: "Richard",
			lastName: "Worth",
			country: "USA",
			twitter: "rworth",
			github: "rdworth"
		},
		{
			firstName: "Jörn",
			lastName: "Zaefferer",
			country: "Germany",
			twitter: "bassistance",
			github: "jzaefferer"
		}
	];

	$(function() {
		var details = $("#developer");
		var datastore = new $.ui.datastore({
			source: data,
			select: function( event, ui ) {
				$( "#developer-tmpl" ).tmpl( ui.item.props ).appendTo( details.empty() );
			}
		}, {} );
		datastore.select( 0 );

		var summaryTable = $( "#developers" )
				.delegate( "tbody > tr", "click", function() {
					datastore.select( $(this).tmplItem().data.__ref__ );
				});

		var tbody = summaryTable.find( "tbody" );
		$.each( datastore.items( 0, 5 ), function( itemId, item ) {
			$( "#row-tmpl" ).tmpl( item.props ).appendTo( tbody );
		});
	});
	</script>
</head>
<body>

<table id="developers">
	<thead>
		<tr>
			<th data-field="firstName">First Name</th>
			<th data-field="lastName">Last Name</th>
			<th data-field="country">Country</th>
		</tr>
	</thead>
	<tbody>
	</tbody>
</table>

<div id="developer"></div>

<script type="text/x-jquery-tmpl" id="row-tmpl">
<tr>
	<td>${firstName}</td>
	<td>${lastName}</td>
	<td>${country}</td>
</tr>
</script>

<script type="text/x-jquery-tmpl" id="developer-tmpl">
<div>
	<h2>${lastName}, ${firstName}</h2>
	<p>GitHub: <a href="http://github.com/${github}">${github}</a></p>
	<p>Twitter: <a href="http://twitter.com/${twitter}">${twitter}</a></p>
</div>
</script>

</body>
</html>
